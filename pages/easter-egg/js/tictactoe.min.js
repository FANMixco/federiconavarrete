const cells=document.querySelectorAll("[data-cell]"),message=document.getElementById("message");let currentPlayer="X",aiRole="O",gameActive=!0,aiThinking=!1;function restartGame(){location.reload()}document.getElementById("footer").innerHTML+=`&nbsp;${(new Date).getFullYear()}`;const winningCombinations=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];function handleWinAndDraw(e){if(checkWin(e))message.classList.add("win-text"),highlightWinner(),message.textContent=`${e} wins!`,gameActive=!1;else{if(!isDraw())return!0;message.classList.add("win-text"),message.textContent="It's a draw!",gameActive=!1,handleDraw()}return!1}function handleCellClick(e){const t=e.target;parseInt(t.getAttribute("data-cell"));""===t.textContent&&gameActive&&!aiThinking&&currentPlayer!==aiRole&&(t.textContent=currentPlayer,handleWinAndDraw(currentPlayer)&&(currentPlayer="X"===currentPlayer?"O":"X",message.textContent=`${currentPlayer}'s turn`,currentPlayer===aiRole&&(aiThinking=!0,setTimeout(makeMove,500))))}function makeRandomMove(){const e=[...cells].filter((e=>""===e.textContent));e[Math.floor(Math.random()*e.length)].textContent=currentPlayer,handleWinAndDraw(currentPlayer)&&(currentPlayer="X"==currentPlayer?"O":"X",message.textContent=`Your turn ${currentPlayer}`)}function makeOptimalMove(){let e,t=-1/0;for(let n=0;n<cells.length;n++)if(""===cells[n].textContent){cells[n].textContent=currentPlayer;const l=minimax(cells,0,!1);cells[n].textContent="",l>t&&(t=l,e=n)}cells[e].textContent=currentPlayer,handleWinAndDraw(currentPlayer)&&(currentPlayer="X"==currentPlayer?"O":"X",message.textContent=`Your turn ${currentPlayer}`),aiThinking=!1}function makeMove(){currentPlayer===aiRole&&(Math.random()<.75?makeOptimalMove():makeRandomMove(),aiThinking=!1,cells.forEach((e=>e.addEventListener("click",handleCellClick))))}function checkWin(e){return winningCombinations.some((t=>t.every((t=>cells[t].textContent===e))))}function isDraw(){return[...cells].every((e=>""!==e.textContent))&&!checkWin("X")&&!checkWin("O")}function highlightWinner(){winningCombinations.forEach((e=>{const[t,n,l]=e;cells[t].textContent===cells[n].textContent&&cells[n].textContent===cells[l].textContent&&""!==cells[t].textContent&&(cells[t].classList.add("winner"),cells[n].classList.add("winner"),cells[l].classList.add("winner"))}))}function handleDraw(){cells.forEach((e=>{e.classList.add("draw")})),document.querySelector(".board").classList.add("draw-board")}function minimax(e,t,n){const l=checkResult();if(null!==l)return l;if(n){let n=-1/0;for(let l=0;l<e.length;l++)if(""===e[l].textContent){e[l].textContent="O";const r=minimax(e,t+1,!1);e[l].textContent="",n=Math.max(r,n)}return n}{let n=1/0;for(let l=0;l<e.length;l++)if(""===e[l].textContent){e[l].textContent="X";const r=minimax(e,t+1,!0);e[l].textContent="",n=Math.min(r,n)}return n}}function checkResult(){for(let e=0;e<winningCombinations.length;e++){const[t,n,l]=winningCombinations[e];if(cells[t].textContent===cells[n].textContent&&cells[n].textContent===cells[l].textContent&&""!==cells[t].textContent)return"O"===cells[t].textContent?1:-1}return isDraw()?0:null}function startGame(){cells.forEach((e=>{e.textContent="",e.classList.remove("winner"),e.addEventListener("click",handleCellClick)})),gameActive=!0,Math.random()<.5?(aiThinking=!0,aiRole="X",message.textContent=`${currentPlayer}'s turn`,makeMove()):message.textContent=`Your turn ${currentPlayer}`}startGame();